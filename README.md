# 半同步半异步线程池



使用了`C++11的锁`、`匿名函数`、`条件变量`、`右值引用`、`std::move`以及`std::forward`等;



半同步半异步线程池分为三层：同步服务层、排队层、异步服务层

- 第一层是同步服务层，处理来自上层的服务请求，上层的请求可能是并发的，这些请求不是马上处理，而是将这些任务放在一个同步排队层中，等待处理。

- 第二层是同步排队层，来自上层的任务请求都会加入排队层中等待处理。
- 第三层是异步服务层，这一层中会有多个线程同时取出处理排队层中的任务。



同步排队层使用同步队列实现，保证了队列数据中`共享数据的线程安全`，还为上一层同步服务层提供添加新任务的接口，和提供下一层异步服务层取走任务的接口；同时还要`限制任务数上限`，避免任务过多导致内存暴涨的问题。



一开始会启动一定数量的线程，这些线程是属于异步层的，主要用于并行处理排队层中的任务，当任务为空时这些线程会等待任务的到来，如果发现任务队列中有任务了，线程池会唤醒一个线程去处理新任务，同步服务层则是不断并将新任务添加到同步排队层中，但是不可以超过设定的上限。

